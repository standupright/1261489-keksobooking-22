(()=>{var e={791:()=>{const e=["gif","jpg","jpeg","png"],t=document.querySelector("#avatar"),a=document.querySelector(".ad-form-header__pic-preview"),r=document.querySelector("#images"),o=document.querySelector(".ad-form__photo");t.addEventListener("change",(()=>{const r=t.files[0],o=r.name.toLowerCase();if(e.some((e=>o.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{a.src=e.result})),e.readAsDataURL(r)}})),r.addEventListener("change",(()=>{const t=r.files[0],a=t.name.toLowerCase();if(e.some((e=>a.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{o.style.backgroundImage=`url(${e.result})`,o.style.backgroundSize="70px 70px"})),e.readAsDataURL(t)}}))}},t={};function a(r){if(t[r])return t[r].exports;var o=t[r]={exports:{}};return e[r](o,o.exports,a),o.exports}a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};(()=>{"use strict";a.d(r,{On:()=>R,Lk:()=>E,DK:()=>P,P2:()=>K,RO:()=>Q,sM:()=>X,BU:()=>J});const e=document.querySelector("#card"),t=(t,a="any",r="any",o="any",n="any",l=[])=>{const s=[],c=document.createDocumentFragment(),i=((e,t="any",a="any",r="any",o="any",n=[])=>{const l=[];return e.slice().filter((e=>{((e,t)=>e.offer.type===t||"any"===t)(e,t)&&((e,t)=>{const a=e.offer.price;switch(t){case"any":return!0;case"middle":return a>=1e4&&a<5e4;case"low":return a<=1e4;case"high":return a>=5e4;default:return!0}})(e,a)&&((e,t)=>{const a=e.offer.rooms;switch(t){case"any":return!0;case"1":return 1===a;case"2":return 2===a;case"3":return 3===a;default:return!1}})(e,r)&&((e,t)=>{const a=e.offer.guests;switch(t){case"any":return!0;case"0":return 0===a;case"1":return 1===a;case"2":return 2===a;default:return!1}})(e,o)&&((e,t)=>{const a=e.offer.features;if(t.length){let e=0;for(let r=0;r<t.length;r++)for(let o=0;o<a.length;o++)a[o]===t[r]&&e++;return e===t.length}return!0})(e,n)&&l.push(e)})),l})(t,a,r,o,n,l).slice(0,10);i.forEach((({author:t,offer:a})=>{const r=e.cloneNode(!0).content,o=r.querySelector(".popup__title"),n=r.querySelector(".popup__text--price"),l=r.querySelector(".popup__text--address"),s=r.querySelector(".popup__type"),i=r.querySelector(".popup__text--capacity"),d=r.querySelector(".popup__text--time"),u=r.querySelector(".popup__features"),p=r.querySelector(".popup__description"),y=r.querySelector(".popup__photos"),m=r.querySelector(".popup__avatar"),h=(e,t)=>{""===t?e.classList.add("visually-hidden"):e.textContent=t};h(o,a.title),h(n,a.price),h(l,a.address),h(p,a.description),""===t.avatar?m.classList.add("visually-hidden"):m.src=t.avatar,""===a.type?s.classList.add("visually-hidden"):s.textContent={flat:"Квартира",bungalow:"Бунгало",house:"Дом",palace:"Дворец"}[a.type],void 0===a.rooms||void 0===a.guests?i.classList.add("visually-hidden"):i.textContent=a.rooms+" комнаты для "+a.guests+" гостей",d.textContent="Заезд после "+a.checkin+", выезд до "+a.checkout,u.innerHTML="",a.features.length?a.features.forEach((e=>{((e,t)=>{const a=document.createElement("li");a.classList.add("popup__feature"),a.classList.add("popup__feature--"+e),a.textContent=e,t.appendChild(a)})(e,u)})):u.classList.add("visually-hidden"),y.innerHTML="",a.photos.length?a.photos.forEach(((e,t)=>{(e=>{const t=document.createElement("img");t.classList.add("popup__photo"),t.width="45",t.height="40",e.appendChild(t)})(y),y.children[t]&&(y.children[t].src=e)})):y.classList.add("visually-hidden"),c.appendChild(r)}));for(let e=0;e<c.children.length;e++)s[e]=c.children[e];Q(),J(i,s)},o=document.querySelector("#success"),n=document.querySelector("#error"),l=document.querySelector("main"),s=()=>{const e=document.createElement("div");e.style.zIndex=100,e.style.position="absolute",e.style.left=0,e.style.top=0,e.style.right=0,e.style.padding="20px 10px",e.style.fontSize="18px",e.style.textAlign="center",e.style.backgroundColor="white",e.style.width=200,e.style.height=200,e.textContent="Произошла ошибка при загрузке данных с сервера :( Обновите страницу!",document.body.append(e),setTimeout((()=>{e.remove()}),5e3)},c=document.createElement("div"),i=e=>{(e=>"Escape"===e.key||"Esc"===e.key)(e)&&(e.preventDefault(),u())},d=e=>{e.preventDefault(),u()},u=()=>{c.remove(),document.removeEventListener("keydown",i),c.removeEventListener("click",d)},p=()=>{const e=n.cloneNode(!0).content;c.innerHTML="",c.append(e),l.append(c),document.addEventListener("keydown",i(c)),c.addEventListener("click",d(c))},y={flat:1e3,bungalow:0,house:5e3,palace:1e4},m=document.querySelector(".map__filters"),h=m.querySelector(".map__features"),v=m.querySelectorAll(".map__filter"),f=m.querySelector("#housing-type"),g=m.querySelector("#housing-price"),S=m.querySelector("#housing-rooms"),q=m.querySelector("#housing-guests"),b=document.querySelectorAll(".map__checkbox"),w=document.querySelector(".ad-form"),k=document.querySelector("#title"),E=document.querySelector("#address"),C=document.querySelector("#price"),x=document.querySelector("#type"),V=document.querySelector("#timein"),A=document.querySelector("#timeout"),D=document.querySelector("#room_number"),F=document.querySelector("#capacity"),T=document.querySelectorAll(".feature__checkbox"),M=w.querySelectorAll("fieldset"),O=document.querySelector("#description"),j=document.querySelector(".ad-form__reset"),z=document.querySelector(".ad-form__photo"),U=document.querySelector(".ad-form-header__pic-preview"),P=()=>{w.classList.add("ad-form--disabled");for(let e=0;e<M.length;e++)M[e].disabled=!0;m.classList.add("ad-form--disabled"),h.disabled=!0;for(let e=0;e<v.length;e++)v[e].disabled=!0},R=()=>{w.classList.remove("ad-form--disabled");for(let e=0;e<M.length;e++)M[e].disabled=!1};E.setAttribute("readonly",!0),E.value="35.68170, 139.75388";let H=5e3;x.addEventListener("change",(function(){H=y[this.value],C.min=H,C.placeholder=y[this.value]}));const I=function(e){return function(){e.value=this.value}};V.addEventListener("change",I(A)),A.addEventListener("change",I(V)),k.addEventListener("invalid",(()=>{k.validity.valueMissing?k.setCustomValidity("Обязательное поле"):k.setCustomValidity("")})),k.addEventListener("input",(()=>{const e=k.value.length;e<30?k.setCustomValidity("Ещё "+(30-e)+" симв."):e>100?k.setCustomValidity("Удалите лишние "+(e-100)+" симв."):k.setCustomValidity(""),k.reportValidity()})),C.addEventListener("invalid",(()=>{switch(!0){case C.validity.valueMissing:C.setCustomValidity("Обязательное поле");break;case C.validity.rangeOverflow:C.setCustomValidity("Цена не может превышать 1000000");break;case C.validity.rangeUnderflow:C.setCustomValidity("Цена не может быть ниже "+H);break;default:C.setCustomValidity("")}})),C.addEventListener("input",(()=>{const e=C.value;e<H?C.setCustomValidity("Цена не может быть ниже "+H):e>=1e6?C.setCustomValidity("Цена не может превышать 1000000"):C.setCustomValidity(""),C.reportValidity()})),F.addEventListener("change",(function(){"0"===F.value&&"100"!==D.value?F.setCustomValidity("Выбранное количество гостей может расположиться лишь в 100 комнатах"):"1"===F.value&&"100"===D.value?F.setCustomValidity("Выбранное количество гостей может расположиться лишь в 1, 2 или 3 комнате"):"2"!==F.value||"1"!==D.value&&"100"!==D.value?"3"===F.value&&"3"!==D.value?F.setCustomValidity("Выбранное количество гостей может расположиться лишь в 3 комнатах"):F.setCustomValidity(""):F.setCustomValidity("Выбранное количество гостей может расположиться лишь в 2 или 3 комнатах"),F.reportValidity()}));const N=()=>{f.value="any",g.value="any",S.value="any",q.value="any",k.value="",E.value="35.68170, 139.75388",x.value="flat",C.value="",V.value="12:00",A.value="12:00",D.value="1",F.value="1",O.value="",z.style="",U.src="img/muffin-grey.svg";for(let e=0;e<T.length;e++)T[e].checked=!1,b[e].checked=!1;K.setLatLng({lat:35.6817,lng:139.75388}),X()};j.addEventListener("click",(e=>{e.preventDefault(),N()})),P();const W=L.map("map-canvas").on("load",(()=>{R()})).setView({lat:35.6817,lng:139.753882},9);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors | Icons made by <a href="https://www.freepik.com" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a>'}).addTo(W);const B=L.icon({iconUrl:"img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),K=L.marker({lat:35.6817,lng:139.75388},{draggable:!0,icon:B});K.addTo(W),K.on("moveend",(e=>{(e=>{let t=e.getLatLng();E.value=t.lat.toFixed(5)+", "+t.lng.toFixed(5)})(e.target)}));const $=L.icon({iconUrl:"img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]}),G=[],J=(e,t)=>{e.forEach(((e,a)=>{const r=L.marker({lat:e.location.lat,lng:e.location.lng},{icon:$});G.push(r),r.addTo(W).bindPopup(t[a],{keepInView:!0})}))},Q=()=>{for(let e=0;e<G.length;e++)W.removeLayer(G[e])};a(791);const X=()=>{(e=>{try{fetch("https://22.javascript.pages.academy/keksobooking/data").then((e=>e.json())).then((e=>{(e=>{(()=>{m.classList.remove("ad-form--disabled"),h.disabled=!1;for(let e=0;e<v.length;e++)v[e].disabled=!1})(),t(e),a=_.debounce(((a,r,o,n,l)=>t(e,a,r,o,n,l)),500),m.addEventListener("change",(()=>{a(f.value,g.value,S.value,q.value,(()=>{let e=[];for(let t=0;t<b.length;t++)b[t].checked&&e.push(b[t].value);return e})())}));var a})(e)})).catch((()=>s()))}catch(e){s()}})()};X(),w.addEventListener("submit",(e=>{e.preventDefault();const t=new FormData(w);var a;a=N,fetch("https://22.javascript.pages.academy/keksobooking",{method:"POST",body:t}).then((e=>{e.ok?((()=>{const e=o.cloneNode(!0).content;c.innerHTML="",c.append(e),l.append(c),document.addEventListener("keydown",i),c.addEventListener("click",d)})(),a()):p()})).catch((()=>{p()}))}))})()})();
//# sourceMappingURL=main.bunndle.js.map