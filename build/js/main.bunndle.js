(()=>{var e={791:()=>{const e=["gif","jpg","jpeg","png"],t=document.querySelector("#avatar"),a=document.querySelector(".ad-form-header__pic-preview"),o=document.querySelector("#images"),r=document.querySelector(".ad-form__photo");t.addEventListener("change",(()=>{const o=t.files[0],r=o.name.toLowerCase();if(e.some((e=>r.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{a.src=e.result})),e.readAsDataURL(o)}})),o.addEventListener("change",(()=>{const t=o.files[0],a=t.name.toLowerCase();if(e.some((e=>a.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{r.style.backgroundImage=`url(${e.result})`,r.style.backgroundSize="70px 70px"})),e.readAsDataURL(t)}}))}},t={};function a(o){if(t[o])return t[o].exports;var r=t[o]={exports:{}};return e[o](r,r.exports,a),r.exports}a.d=(e,t)=>{for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var o={};(()=>{"use strict";a.d(o,{On:()=>T,Lk:()=>k,DK:()=>R,P2:()=>B,RO:()=>X,sM:()=>Y,BU:()=>Q});const e=document.querySelector("#card"),t=(t,a="any",o="any",r="any",n="any",l=[])=>{const s=[],i=[],c=document.createDocumentFragment();t.slice().filter((e=>{((e,t)=>e.offer.type===t||"any"===t)(e,a)&&((e,t)=>{const a=e.offer.price;switch(t){case"any":return!0;case"middle":return a>=1e4&&a<5e4;case"low":return a<=1e4;case"high":return a>=5e4;default:return!0}})(e,o)&&((e,t)=>{const a=e.offer.rooms;switch(t){case"any":return!0;case"1":return 1===a;case"2":return 2===a;case"3":return 3===a;default:return!0}})(e,r)&&((e,t)=>{const a=e.offer.guests;switch(t){case"any":return!0;case"1":return 1===a;case"2":return 2===a;case"0":return 0===a;default:return!1}})(e,n)&&((e,t)=>{const a=e.offer.features;if(0===t.length)return!0;{let e=0;for(let o=0;o<t.length;o++)for(let r=0;r<a.length;r++)a[r]===t[o]&&e++;return e===t.length}})(e,l)&&s.push(e)})),s.forEach((({author:t,offer:a})=>{const o=e.cloneNode(!0).content,r=o.querySelector(".popup__title"),n=o.querySelector(".popup__text--price"),l=o.querySelector(".popup__text--address"),s=o.querySelector(".popup__type"),i=o.querySelector(".popup__text--capacity"),d=o.querySelector(".popup__text--time"),u=o.querySelector(".popup__features"),p=o.querySelector(".popup__description"),v=o.querySelector(".popup__photos"),y=o.querySelector(".popup__avatar"),m=(e,t)=>{""===t?e.classList.add("visually-hidden"):e.textContent=t};m(r,a.title),m(n,a.price),m(l,a.address),m(p,a.description),""===t.avatar?y.classList.add("visually-hidden"):y.src=t.avatar;const h={flat:"Квартира",bungalow:"Бунгало",house:"Дом",palace:"Дворец"};for(""===a.type?y.classList.add("visually-hidden"):Object.keys(h).forEach((e=>{a.type===e&&(s.textContent=h[`${e}`])})),void 0===a.rooms||void 0===a.guests?i.classList.add("visually-hidden"):i.textContent=a.rooms+" комнаты для "+a.guests+" гостей",d.textContent="Заезд после "+a.checkin+", выезд до "+a.checkout;u.firstChild;)u.removeChild(u.firstChild);for(0===a.features.length?u.classList.add("visually-hidden"):a.features.forEach((e=>{((e,t)=>{const a=document.createElement("li");a.classList.add(".popup__feature"),a.classList.add(".popup__feature--"+e),a.textContent=e,t.appendChild(a)})(e,u)}));v.firstChild;)v.removeChild(v.firstChild);0===a.photos.length?v.classList.add("visually-hidden"):a.photos.forEach(((e,t)=>{(e=>{const t=document.createElement("img");t.classList.add(".popup__photo"),t.width="45",t.height="40",e.appendChild(t)})(v),v.children[t]&&(v.children[t].src=e)})),c.appendChild(o)}));for(let e=0;e<c.children.length;e++)i[e]=c.children[e];X(),Q(s,i)},r=document.querySelector("#success"),n=document.querySelector("#error"),l=document.querySelector("main"),s=()=>{const e=document.createElement("div");e.style.zIndex=100,e.style.position="absolute",e.style.left=0,e.style.top=0,e.style.right=0,e.style.padding="20px 10px",e.style.fontSize="18px",e.style.textAlign="center",e.style.backgroundColor="white",e.style.width=200,e.style.height=200,e.textContent="Произошла ошибка при загрузке данных с сервера :( Обновите страницу!",document.body.append(e),setTimeout((()=>{e.remove()}),5e3)},i=e=>t=>{(e=>"Escape"===e.key||"Esc"===e.key)(t)&&(t.preventDefault(),d(e))},c=e=>t=>{t.preventDefault(),d(e)},d=e=>{e.remove(),document.removeEventListener("keypress",i(e)),e.removeEventListener("click",c(e))},u=()=>{const e=n.cloneNode(!0).content,t=document.createElement("div");t.append(e),l.append(t),document.addEventListener("keydown",i(t)),t.addEventListener("click",c(t))},p={flat:1e3,bungalow:0,house:5e3,palace:1e4},v=document.querySelector(".map__filters"),y=v.querySelector(".map__features"),m=v.querySelectorAll(".map__filter"),h=v.querySelector("#housing-type"),f=v.querySelector("#housing-price"),g=v.querySelector("#housing-rooms"),S=v.querySelector("#housing-guests"),q=document.querySelectorAll(".map__checkbox"),E=document.querySelector(".ad-form"),b=document.querySelector("#title"),k=document.querySelector("#address"),w=document.querySelector("#price"),C=document.querySelector("#type"),x=document.querySelector("#timein"),V=document.querySelector("#timeout"),A=document.querySelector("#room_number"),D=document.querySelector("#capacity"),F=document.querySelectorAll(".feature__checkbox"),O=E.querySelectorAll("fieldset"),j=document.querySelector("#description"),z=document.querySelector(".ad-form__reset"),U=document.querySelector(".ad-form__photo"),P=document.querySelector(".ad-form-header__pic-preview"),R=()=>{E.classList.add("ad-form--disabled");for(let e=0;e<O.length;e++)O[e].disabled=!0;v.classList.add("ad-form--disabled"),y.disabled=!0;for(let e=0;e<m.length;e++)m[e].disabled=!0},T=()=>{E.classList.remove("ad-form--disabled");for(let e=0;e<O.length;e++)O[e].disabled=!1};k.setAttribute("readonly",!0),k.value="35.68170, 139.75388";let I=5e3;C.addEventListener("change",(function(){I=p[`${this.value}`],w.min=I,w.placeholder=p[`${this.value}`]}));const M=function(e){return function(){e.value=this.value}};x.addEventListener("change",M(V)),V.addEventListener("change",M(x)),b.addEventListener("invalid",(()=>{b.validity.valueMissing?b.setCustomValidity("Обязательное поле"):b.setCustomValidity("")})),b.addEventListener("input",(()=>{const e=b.value.length;e<30?b.setCustomValidity("Ещё "+(30-e)+" симв."):e>100?b.setCustomValidity("Удалите лишние "+(e-100)+" симв."):b.setCustomValidity(""),b.reportValidity()})),w.addEventListener("invalid",(()=>{w.validity.valueMissing?w.setCustomValidity("Обязательное поле"):w.validity.rangeOverflow?w.setCustomValidity("Цена не может превышать 1000000"):w.validity.rangeUnderflow?w.setCustomValidity("Цена не может быть ниже "+I):w.setCustomValidity("")})),w.addEventListener("input",(()=>{const e=w.value;e<I?w.setCustomValidity("Цена не может быть ниже "+I):e>=1e6?w.setCustomValidity("Цена не может превышать 1000000"):w.setCustomValidity(""),w.reportValidity()})),D.addEventListener("change",(function(){"0"===D.value&&"100"!==A.value?D.setCustomValidity("Выбранное количество гостей может расположиться лишь в 100 комнатах"):"1"===D.value&&"100"===A.value?D.setCustomValidity("Выбранное количество гостей может расположиться лишь в 1, 2 или 3 комнате"):"2"!==D.value||"1"!==A.value&&"100"!==A.value?"3"===D.value&&"3"!==A.value?D.setCustomValidity("Выбранное количество гостей может расположиться лишь в 3 комнатах"):D.setCustomValidity(""):D.setCustomValidity("Выбранное количество гостей может расположиться лишь в 2 или 3 комнатах"),D.reportValidity()}));const $=()=>{h.value="any",f.value="any",g.value="any",S.value="any",b.value="",k.value="35.68170, 139.75388",C.value="flat",w.value="",x.value="12:00",V.value="12:00",A.value="1",D.value="1",j.value="",U.style="",P.src="img/muffin-grey.svg";for(let e=0;e<F.length;e++)F[e].checked=!1,q[e].checked=!1;B.setLatLng({lat:35.6817,lng:139.75388}),Y()};z.addEventListener("click",(e=>{e.preventDefault(),$()})),R();const N=L.map("map-canvas").on("load",(()=>{T()})).setView({lat:35.6817,lng:139.753882},9);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors | Icons made by <a href="https://www.freepik.com" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a>'}).addTo(N);const W=L.icon({iconUrl:"img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),B=L.marker({lat:35.6817,lng:139.75388},{draggable:!0,icon:W});B.addTo(N),B.on("moveend",(e=>{(e=>{let t=e.getLatLng();k.value=t.lat.toFixed(5)+", "+t.lng.toFixed(5)})(e.target)}));let K,G=0;const H=L.icon({iconUrl:"img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]}),J=[],Q=(e,t)=>{for(let o=0;o<e.length;o++){const r=L.marker({lat:e[o].location.lat,lng:e[o].location.lng},{icon:H});J.push(r),r.addTo(N).bindPopup((K=(a=t)[G],G++,G>a.length-1&&(G=0),K),{keepInView:!0})}var a},X=()=>{for(let e=0;e<J.length;e++)N.removeLayer(J[e])};a(791);const Y=()=>{(e=>{try{fetch("https://22.javascript.pages.academy/keksobooking/data").then((e=>e.json())).then((e=>{(e=>{const a=e.slice(0,10);(()=>{v.classList.remove("ad-form--disabled"),y.disabled=!1;for(let e=0;e<m.length;e++)m[e].disabled=!1})(),t(a),(e=>{const t=()=>{let e=[];for(let t=0;t<q.length;t++)q[t].checked&&e.push(q[t].value);return e};h.addEventListener("change",(()=>{e(h.value,f.value,g.value,S.value,t())})),f.addEventListener("change",(()=>{e(h.value,f.value,g.value,S.value,t())})),g.addEventListener("change",(()=>{e(h.value,f.value,g.value,S.value,t())})),S.addEventListener("change",(()=>{e(h.value,f.value,g.value,S.value,t())}));for(let a=0;a<q.length;a++)q[a].addEventListener("click",(()=>{e(h.value,f.value,g.value,S.value,t())}))})(_.debounce(((e,o,r,n,l)=>t(a,e,o,r,n,l)),500))})(e)})).catch((()=>s()))}catch(e){s()}})()};Y(),E.addEventListener("submit",(e=>{e.preventDefault();const t=new FormData(E);var a;a=$,fetch("https://22.javascript.pages.academy/keksobooking",{method:"POST",body:t}).then((e=>{e.ok?((()=>{const e=r.cloneNode(!0).content,t=document.createElement("div");t.append(e),l.append(t),document.addEventListener("keydown",i(t)),t.addEventListener("click",c(t))})(),a()):u()})).catch((()=>{u()}))}))})()})();
//# sourceMappingURL=main.bunndle.js.map