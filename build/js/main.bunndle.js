(()=>{var e={791:()=>{const e=["gif","jpg","jpeg","png"],t=document.querySelector("#avatar"),r=document.querySelector(".ad-form-header__pic-preview"),o=document.querySelector("#images"),a=document.querySelector(".ad-form__photo");t.addEventListener("change",(()=>{const o=t.files[0],a=o.name.toLowerCase();if(e.some((e=>a.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{r.src=e.result})),e.readAsDataURL(o)}})),o.addEventListener("change",(()=>{const t=o.files[0],r=t.name.toLowerCase();if(e.some((e=>r.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{a.style.backgroundImage=`url(${e.result})`,a.style.backgroundSize="70px 70px"})),e.readAsDataURL(t)}}))}},t={};function r(o){if(t[o])return t[o].exports;var a=t[o]={exports:{}};return e[o](a,a.exports,r),a.exports}r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var o={};(()=>{"use strict";r.d(o,{On:()=>N,Lk:()=>V,DK:()=>I,P2:()=>J,RO:()=>Z,sM:()=>ee,BU:()=>Y});const e=document.querySelector(".map__filters"),t=e.querySelector(".map__features"),a=e.querySelectorAll(".map__filter"),n=(e.querySelector("#housing-type"),e.querySelector("#housing-price"),e.querySelector("#housing-rooms"),e.querySelector("#housing-guests"),document.querySelectorAll(".map__checkbox"),document.querySelector("#card")),l=(e,t="any",r="any",o="any",a="any",l=[])=>{const s=[],c=document.createDocumentFragment(),i=((e,t="any",r="any",o="any",a="any",n=[])=>{const l=[];return e.slice().filter((e=>{((e,t)=>e.offer.type===t||"any"===t)(e,t)&&((e,t)=>{const r=e.offer.price;switch(t){case"any":return!0;case"middle":return r>=1e4&&r<5e4;case"low":return r<=1e4;case"high":return r>=5e4;default:return!1}})(e,r)&&((e,t)=>{const r=e.offer.rooms;switch(t){case"any":return!0;case"1":return 1===r;case"2":return 2===r;case"3":return 3===r;default:return!1}})(e,o)&&((e,t)=>{const r=e.offer.guests;switch(t){case"any":return!0;case"0":return 0===r;case"1":return 1===r;case"2":return 2===r;default:return!1}})(e,a)&&((e,t)=>{const r=e.offer.features;if(t.length){let e=0;for(let o=0;o<t.length;o++)for(let a=0;a<r.length;a++)r[a]===t[o]&&e++;return e===t.length}return!0})(e,n)&&l.push(e)})),l})(e,t,r,o,a,l).slice(0,10);i.forEach((({author:e,offer:t})=>{const r=n.cloneNode(!0).content,o=r.querySelector(".popup__title"),a=r.querySelector(".popup__text--price"),l=r.querySelector(".popup__text--address"),s=r.querySelector(".popup__type"),i=r.querySelector(".popup__text--capacity"),d=r.querySelector(".popup__text--time"),u=r.querySelector(".popup__features"),p=r.querySelector(".popup__description"),y=r.querySelector(".popup__photos"),m=r.querySelector(".popup__avatar"),h=(e,t)=>{""===t?e.classList.add("visually-hidden"):e.textContent=t};h(o,t.title),h(a,t.price),h(l,t.address),h(p,t.description),""===e.avatar?m.classList.add("visually-hidden"):m.src=e.avatar,""===t.type?s.classList.add("visually-hidden"):s.textContent={flat:"Квартира",bungalow:"Бунгало",house:"Дом",palace:"Дворец"}[t.type],void 0===t.rooms||void 0===t.guests?i.classList.add("visually-hidden"):i.textContent=t.rooms+" комнаты для "+t.guests+" гостей",d.textContent="Заезд после "+t.checkin+", выезд до "+t.checkout,u.innerHTML="",t.features.length?t.features.forEach((e=>{((e,t)=>{const r=document.createElement("li");r.classList.add("popup__feature"),r.classList.add("popup__feature--"+e),r.textContent=e,t.appendChild(r)})(e,u)})):u.classList.add("visually-hidden"),y.innerHTML="",t.photos.length?t.photos.forEach(((e,t)=>{(e=>{const t=document.createElement("img");t.classList.add("popup__photo"),t.width="45",t.height="40",e.appendChild(t)})(y),y.children[t]&&(y.children[t].src=e)})):y.classList.add("visually-hidden"),c.appendChild(r)}));for(let e=0;e<c.children.length;e++)s[e]=c.children[e];Z(),Y(i,s)},s=document.querySelector("#success"),c=document.querySelector("#error"),i=document.querySelector("main"),d=()=>{const e=document.createElement("div");e.style.zIndex=100,e.style.position="absolute",e.style.left=0,e.style.top=0,e.style.right=0,e.style.padding="20px 10px",e.style.fontSize="18px",e.style.textAlign="center",e.style.backgroundColor="white",e.style.width=200,e.style.height=200,e.textContent="Произошла ошибка при загрузке данных с сервера :( Обновите страницу!",document.body.append(e),setTimeout((()=>{e.remove()}),5e3)},u=document.createElement("div"),p=e=>{(e=>"Escape"===e.key||"Esc"===e.key)(e)&&(e.preventDefault(),m())},y=e=>{e.preventDefault(),m()},m=()=>{u.remove(),document.removeEventListener("keydown",p),u.removeEventListener("click",y)},h=()=>{const e=c.cloneNode(!0).content;u.innerHTML="",u.append(e),i.append(u),document.addEventListener("keydown",p(u)),u.addEventListener("click",y(u))},v={flat:1e3,bungalow:0,house:5e3,palace:1e4},f=document.querySelector(".map__filters"),g=f.querySelector(".map__features"),S=f.querySelectorAll(".map__filter"),q=f.querySelector("#housing-type"),b=f.querySelector("#housing-price"),k=f.querySelector("#housing-rooms"),w=f.querySelector("#housing-guests"),E=document.querySelectorAll(".map__checkbox"),C=document.querySelector(".ad-form"),x=document.querySelector("#title"),V=document.querySelector("#address"),A=document.querySelector("#price"),D=document.querySelector("#type"),F=document.querySelector("#timein"),T=document.querySelector("#timeout"),M=document.querySelector("#room_number"),O=document.querySelector("#capacity"),j=document.querySelectorAll(".feature__checkbox"),z=C.querySelectorAll("fieldset"),U=document.querySelector("#description"),P=document.querySelector(".ad-form__reset"),R=document.querySelector(".ad-form__photo"),H=document.querySelector(".ad-form-header__pic-preview"),I=()=>{C.classList.add("ad-form--disabled");for(let e=0;e<z.length;e++)z[e].disabled=!0;(()=>{e.classList.add("ad-form--disabled"),t.disabled=!0;for(let e=0;e<a.length;e++)a[e].disabled=!0})()},N=()=>{C.classList.remove("ad-form--disabled");for(let e=0;e<z.length;e++)z[e].disabled=!1};V.setAttribute("readonly",!0),V.value="35.68170, 139.75388";let W=5e3;D.addEventListener("change",(function(){W=v[this.value],A.min=W,A.placeholder=v[this.value]}));const B=function(e){return function(){e.value=this.value}};F.addEventListener("change",B(T)),T.addEventListener("change",B(F)),x.addEventListener("invalid",(()=>{x.validity.valueMissing?x.setCustomValidity("Обязательное поле"):x.setCustomValidity("")})),x.addEventListener("input",(()=>{const e=x.value.length;e<30?x.setCustomValidity("Ещё "+(30-e)+" симв."):e>100?x.setCustomValidity("Удалите лишние "+(e-100)+" симв."):x.setCustomValidity(""),x.reportValidity()})),A.addEventListener("invalid",(()=>{switch(!0){case A.validity.valueMissing:A.setCustomValidity("Обязательное поле");break;case A.validity.rangeOverflow:A.setCustomValidity("Цена не может превышать 1000000");break;case A.validity.rangeUnderflow:A.setCustomValidity("Цена не может быть ниже "+W);break;default:A.setCustomValidity("")}})),A.addEventListener("input",(()=>{const e=A.value;e<W?A.setCustomValidity("Цена не может быть ниже "+W):e>=1e6?A.setCustomValidity("Цена не может превышать 1000000"):A.setCustomValidity(""),A.reportValidity()})),O.addEventListener("change",(function(){"0"===O.value&&"100"!==M.value?O.setCustomValidity("Выбранное количество гостей может расположиться лишь в 100 комнатах"):"1"===O.value&&"100"===M.value?O.setCustomValidity("Выбранное количество гостей может расположиться лишь в 1, 2 или 3 комнате"):"2"!==O.value||"1"!==M.value&&"100"!==M.value?"3"===O.value&&"3"!==M.value?O.setCustomValidity("Выбранное количество гостей может расположиться лишь в 3 комнатах"):O.setCustomValidity(""):O.setCustomValidity("Выбранное количество гостей может расположиться лишь в 2 или 3 комнатах"),O.reportValidity()}));const K=()=>{q.value="any",b.value="any",k.value="any",w.value="any",x.value="",V.value="35.68170, 139.75388",D.value="flat",A.value="",F.value="12:00",T.value="12:00",M.value="1",O.value="1",U.value="",R.style="",H.src="img/muffin-grey.svg";for(let e=0;e<j.length;e++)j[e].checked=!1,E[e].checked=!1;J.setLatLng({lat:35.6817,lng:139.75388}),ee()};P.addEventListener("click",(e=>{e.preventDefault(),K()})),I();const $=L.map("map-canvas").on("load",(()=>{N()})).setView({lat:35.6817,lng:139.753882},9);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors | Icons made by <a href="https://www.freepik.com" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a>'}).addTo($);const G=L.icon({iconUrl:"img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),J=L.marker({lat:35.6817,lng:139.75388},{draggable:!0,icon:G});J.addTo($),J.on("moveend",(e=>{(e=>{let t=e.getLatLng();V.value=t.lat.toFixed(5)+", "+t.lng.toFixed(5)})(e.target)}));const Q=L.icon({iconUrl:"img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]}),X=[],Y=(e,t)=>{e.forEach(((e,r)=>{const o=L.marker({lat:e.location.lat,lng:e.location.lng},{icon:Q});X.push(o),o.addTo($).bindPopup(t[r],{keepInView:!0})}))},Z=()=>{for(let e=0;e<X.length;e++)$.removeLayer(X[e])};r(791);const ee=()=>{(e=>{try{fetch("https://22.javascript.pages.academy/keksobooking/data").then((e=>e.json())).then((e=>{(e=>{(()=>{f.classList.remove("ad-form--disabled"),g.disabled=!1;for(let e=0;e<S.length;e++)S[e].disabled=!1})(),l(e),t=_.debounce(((t,r,o,a,n)=>l(e,t,r,o,a,n)),500),f.addEventListener("change",(()=>{t(q.value,b.value,k.value,w.value,(()=>{let e=[];for(let t=0;t<E.length;t++)E[t].checked&&e.push(E[t].value);return e})())}));var t})(e)})).catch((()=>d()))}catch(e){d()}})()};ee(),C.addEventListener("submit",(e=>{e.preventDefault();const t=new FormData(C);var r;r=K,fetch("https://22.javascript.pages.academy/keksobooking",{method:"POST",body:t}).then((e=>{e.ok?((()=>{const e=s.cloneNode(!0).content;u.innerHTML="",u.append(e),i.append(u),document.addEventListener("keydown",p),u.addEventListener("click",y)})(),r()):h()})).catch((()=>{h()}))}))})()})();
//# sourceMappingURL=main.bunndle.js.map