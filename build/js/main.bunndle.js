(()=>{var e={791:()=>{const e=["gif","jpg","jpeg","png"],t=document.querySelector("#avatar"),a=document.querySelector(".ad-form-header__pic-preview"),r=document.querySelector("#images"),n=document.querySelector(".ad-form__photo");t.addEventListener("change",(()=>{const r=t.files[0],n=r.name.toLowerCase();if(e.some((e=>n.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{a.src=e.result})),e.readAsDataURL(r)}})),r.addEventListener("change",(()=>{const t=r.files[0],a=t.name.toLowerCase();if(e.some((e=>a.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{n.style.backgroundImage=`url(${e.result})`,n.style.backgroundSize="70px 70px"})),e.readAsDataURL(t)}}))}},t={};function a(r){if(t[r])return t[r].exports;var n=t[r]={exports:{}};return e[r](n,n.exports,a),n.exports}a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};(()=>{"use strict";a.d(r,{On:()=>R,Lk:()=>E,DK:()=>P,P2:()=>K,RO:()=>Q,sM:()=>X,BU:()=>J});const e=document.querySelector(".map__filters"),t=e.querySelector(".map__features"),n=e.querySelectorAll(".map__filter"),o=e.querySelector("#housing-type"),l=e.querySelector("#housing-price"),s=e.querySelector("#housing-rooms"),c=e.querySelector("#housing-guests"),i=document.querySelectorAll(".map__checkbox"),d=document.querySelector("#card"),u=(e,t="any",a="any",r="any",n="any",o=[])=>{const l=[],s=document.createDocumentFragment(),c=((e,t="any",a="any",r="any",n="any",o=[])=>{const l=[];return e.slice().some((e=>{return 10===(s=e,((e,t)=>e.offer.type===t||"any"===t)(s,t)&&((e,t)=>{const a=e.offer.price;switch(t){case"any":return!0;case"middle":return a>=1e4&&a<5e4;case"low":return a<=1e4;case"high":return a>=5e4;default:return!1}})(s,a)&&((e,t)=>{const a=e.offer.rooms;switch(t){case"any":return!0;case"1":return 1===a;case"2":return 2===a;case"3":return 3===a;default:return!1}})(s,r)&&((e,t)=>{const a=e.offer.guests;switch(t){case"any":return!0;case"0":return 0===a;case"1":return 1===a;case"2":return 2===a;default:return!1}})(s,n)&&((e,t)=>{const a=e.offer.features;if(t.length){let e=0;for(let r=0;r<t.length;r++)for(let n=0;n<a.length;n++)a[n]===t[r]&&e++;return e===t.length}return!0})(s,o)&&l.push(s),l).length;var s})),l})(e,t,a,r,n,o).slice(0,10);c.forEach((({author:e,offer:t})=>{const a=d.cloneNode(!0).content,r=a.querySelector(".popup__title"),n=a.querySelector(".popup__text--price"),o=a.querySelector(".popup__text--address"),l=a.querySelector(".popup__type"),c=a.querySelector(".popup__text--capacity"),i=a.querySelector(".popup__text--time"),u=a.querySelector(".popup__features"),p=a.querySelector(".popup__description"),y=a.querySelector(".popup__photos"),m=a.querySelector(".popup__avatar"),h=(e,t)=>{""===t?e.classList.add("visually-hidden"):e.textContent=t};h(r,t.title),h(n,t.price),h(o,t.address),h(p,t.description),""===e.avatar?m.classList.add("visually-hidden"):m.src=e.avatar,""===t.type?l.classList.add("visually-hidden"):l.textContent={flat:"Квартира",bungalow:"Бунгало",house:"Дом",palace:"Дворец"}[t.type],void 0===t.rooms||void 0===t.guests?c.classList.add("visually-hidden"):c.textContent=t.rooms+" комнаты для "+t.guests+" гостей",i.textContent="Заезд после "+t.checkin+", выезд до "+t.checkout,u.innerHTML="",t.features.length?t.features.forEach((e=>{((e,t)=>{const a=document.createElement("li");a.classList.add("popup__feature"),a.classList.add("popup__feature--"+e),a.textContent=e,t.appendChild(a)})(e,u)})):u.classList.add("visually-hidden"),y.innerHTML="",t.photos.length?t.photos.forEach(((e,t)=>{(e=>{const t=document.createElement("img");t.classList.add("popup__photo"),t.width="45",t.height="40",e.appendChild(t)})(y),y.children[t]&&(y.children[t].src=e)})):y.classList.add("visually-hidden"),s.appendChild(a)}));for(let e=0;e<s.children.length;e++)l[e]=s.children[e];Q(),J(c,l)},p=document.querySelector("#success"),y=document.querySelector("#error"),m=document.querySelector("main"),h=()=>{const e=document.createElement("div");e.style.zIndex=100,e.style.position="absolute",e.style.left=0,e.style.top=0,e.style.right=0,e.style.padding="20px 10px",e.style.fontSize="18px",e.style.textAlign="center",e.style.backgroundColor="white",e.style.width=200,e.style.height=200,e.textContent="Произошла ошибка при загрузке данных с сервера :( Обновите страницу!",document.body.append(e),setTimeout((()=>{e.remove()}),5e3)},v=document.createElement("div"),f=e=>{(e=>"Escape"===e.key||"Esc"===e.key)(e)&&(e.preventDefault(),S())},g=e=>{e.preventDefault(),S()},S=()=>{v.remove(),document.removeEventListener("keydown",f),v.removeEventListener("click",g)},q=()=>{const e=y.cloneNode(!0).content;v.innerHTML="",v.append(e),m.append(v),document.addEventListener("keydown",f(v)),v.addEventListener("click",g(v))},b={flat:1e3,bungalow:0,house:5e3,palace:1e4},w=document.querySelector(".ad-form"),k=document.querySelector("#title"),E=document.querySelector("#address"),C=document.querySelector("#price"),x=document.querySelector("#type"),V=document.querySelector("#timein"),A=document.querySelector("#timeout"),D=document.querySelector("#room_number"),F=document.querySelector("#capacity"),T=document.querySelectorAll(".feature__checkbox"),M=document.querySelectorAll("fieldset"),O=document.querySelector("#description"),j=document.querySelector(".ad-form__reset"),z=document.querySelector(".ad-form__photo"),U=document.querySelector(".ad-form-header__pic-preview"),P=()=>{w.classList.add("ad-form--disabled");for(let e=0;e<M.length;e++)M[e].disabled=!0;(()=>{e.classList.add("ad-form--disabled"),t.disabled=!0;for(let e=0;e<n.length;e++)n[e].disabled=!0})()},R=()=>{w.classList.remove("ad-form--disabled");for(let e=0;e<M.length;e++)M[e].disabled=!1};E.setAttribute("readonly",!0),E.value="35.68170, 139.75388";let H=5e3;x.addEventListener("change",(function(){H=b[this.value],C.min=H,C.placeholder=b[this.value]}));const I=function(e){return function(){e.value=this.value}};V.addEventListener("change",I(A)),A.addEventListener("change",I(V)),k.addEventListener("invalid",(()=>{k.validity.valueMissing?k.setCustomValidity("Обязательное поле"):k.setCustomValidity("")})),k.addEventListener("input",(()=>{const e=k.value.length;e<30?k.setCustomValidity("Ещё "+(30-e)+" симв."):e>100?k.setCustomValidity("Удалите лишние "+(e-100)+" симв."):k.setCustomValidity(""),k.reportValidity()})),C.addEventListener("invalid",(()=>{switch(!0){case C.validity.valueMissing:C.setCustomValidity("Обязательное поле");break;case C.validity.rangeOverflow:C.setCustomValidity("Цена не может превышать 1000000");break;case C.validity.rangeUnderflow:C.setCustomValidity("Цена не может быть ниже "+H);break;default:C.setCustomValidity("")}})),C.addEventListener("input",(()=>{const e=C.value;e<H?C.setCustomValidity("Цена не может быть ниже "+H):e>=1e6?C.setCustomValidity("Цена не может превышать 1000000"):C.setCustomValidity(""),C.reportValidity()})),F.addEventListener("change",(function(){"0"===F.value&&"100"!==D.value?F.setCustomValidity("Выбранное количество гостей может расположиться лишь в 100 комнатах"):"1"===F.value&&"100"===D.value?F.setCustomValidity("Выбранное количество гостей может расположиться лишь в 1, 2 или 3 комнате"):"2"!==F.value||"1"!==D.value&&"100"!==D.value?"3"===F.value&&"3"!==D.value?F.setCustomValidity("Выбранное количество гостей может расположиться лишь в 3 комнатах"):F.setCustomValidity(""):F.setCustomValidity("Выбранное количество гостей может расположиться лишь в 2 или 3 комнатах"),F.reportValidity()}));const N=()=>{(()=>{k.value="",E.value="35.68170, 139.75388",x.value="flat",C.value="",V.value="12:00",A.value="12:00",D.value="1",F.value="1",O.value="",z.style="",U.src="img/muffin-grey.svg";for(let e=0;e<T.length;e++)T[e].checked=!1;K.setLatLng({lat:35.6817,lng:139.75388}),X()})(),(()=>{o.value="any",l.value="any",s.value="any",c.value="any";for(let e=0;e<i.length;e++)i[e].checked=!1})()};j.addEventListener("click",(e=>{e.preventDefault(),N()})),P();const W=L.map("map-canvas").on("load",(()=>{R()})).setView({lat:35.6817,lng:139.753882},9);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors | Icons made by <a href="https://www.freepik.com" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a>'}).addTo(W);const B=L.icon({iconUrl:"img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),K=L.marker({lat:35.6817,lng:139.75388},{draggable:!0,icon:B});K.addTo(W),K.on("moveend",(e=>{(e=>{let t=e.getLatLng();E.value=t.lat.toFixed(5)+", "+t.lng.toFixed(5)})(e.target)}));const $=L.icon({iconUrl:"img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]}),G=[],J=(e,t)=>{e.forEach(((e,a)=>{const r=L.marker({lat:e.location.lat,lng:e.location.lng},{icon:$});G.push(r),r.addTo(W).bindPopup(t[a],{keepInView:!0})}))},Q=()=>{for(let e=0;e<G.length;e++)W.removeLayer(G[e])};a(791);const X=()=>{(a=>{try{fetch("https://22.javascript.pages.academy/keksobooking/data").then((e=>e.json())).then((a=>{(a=>{(()=>{e.classList.remove("ad-form--disabled"),t.disabled=!1;for(let e=0;e<n.length;e++)n[e].disabled=!1})(),u(a),r=_.debounce(((e,t,r,n,o)=>u(a,e,t,r,n,o)),500),e.addEventListener("change",(()=>{r(o.value,l.value,s.value,c.value,(()=>{let e=[];for(let t=0;t<i.length;t++)i[t].checked&&e.push(i[t].value);return e})())}));var r})(a)})).catch((()=>h()))}catch(e){h()}})()};X(),w.addEventListener("submit",(e=>{e.preventDefault();const t=new FormData(w);var a;a=N,fetch("https://22.javascript.pages.academy/keksobooking",{method:"POST",body:t}).then((e=>{e.ok?((()=>{const e=p.cloneNode(!0).content;v.innerHTML="",v.append(e),m.append(v),document.addEventListener("keydown",f),v.addEventListener("click",g)})(),a()):q()})).catch((()=>{q()}))}))})()})();
//# sourceMappingURL=main.bunndle.js.map